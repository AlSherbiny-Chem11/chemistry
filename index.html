<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=10.0, user-scalable=yes">
    <title>Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ø§Ù„Ø´Ø±Ø¨ÙŠÙ†ÙŠ Ù„Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap');
        :root { --gold: #c5a059; --dark: #080c14; --panel: #111827; }
        body { font-family: 'Cairo', sans-serif; background: var(--dark); color: white; min-height: 100vh; overflow-x: hidden; }
        
        /* Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© - ÙƒØ§Ù…Ù„Ø© */
        #admin-modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.98); z-index: 10000; padding: 20px; overflow-y: auto; }
        .admin-box { background: var(--panel); border: 3px solid var(--gold); width: 100%; max-width: 850px; border-radius: 40px; padding: 40px; margin: auto; box-shadow: 0 0 100px rgba(0,0,0,1); }

        .delete-section { background: rgba(239, 68, 68, 0.05); border: 2px dashed rgba(239, 68, 68, 0.2); border-radius: 30px; padding: 30px; margin-top: 40px; }
        .delete-card { background: #1a1a1a; border-radius: 20px; padding: 20px; border-right: 6px solid #ef4444; transition: 0.3s; margin-bottom: 15px; }
        .delete-card:hover { transform: scale(1.01); background: #221111; }

        .btn-gold { background: linear-gradient(135deg, #c5a059 0%, #edd3a1 100%); color: #080c14; font-weight: 900; box-shadow: 0 10px 20px rgba(197, 160, 89, 0.2); }
        .lesson-card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05); border-radius: 35px; transition: 0.4s; }
        .lesson-card:hover { border-color: var(--gold); transform: translateY(-10px); }

        /* Ù…Ø´ØºÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ - Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø­Ø±ÙƒØ© ÙŠÙ…ÙŠÙ† ÙˆØ´Ù…Ø§Ù„ */
        #video-player-modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.99); z-index: 20000; align-items: center; justify-content: center; }
        .video-container { 
            width: 95%; 
            max-width: 1050px; 
            height: 85vh; 
            background: black; 
            border-radius: 25px; 
            border: 2px solid var(--gold); 
            overflow: auto; /* Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø£ÙÙ‚ÙŠ ÙˆØ§Ù„Ø±Ø£Ø³ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØªÙƒØ¨ÙŠØ± */
            position: relative; 
            -webkit-overflow-scrolling: touch; 
        }
        
        #main-video-frame { 
            width: 100%; 
            height: 100%; 
            min-width: 100%; 
        }

        #drop-menu { background: var(--panel) !important; border: 2px solid var(--gold); display: none; position: absolute; top: 75px; right: 0; width: 250px; z-index: 9999; border-radius: 25px; }
    </style>
</head>
<body>

    <section id="auth-screen" class="fixed inset-0 z-[9999] flex flex-col items-center justify-center bg-[#080c14]">
        <div class="text-center animate__animated animate__zoomIn">
            <div class="w-24 h-24 bg-[#c5a059] rounded-[35px] mx-auto mb-10 flex items-center justify-center shadow-2xl">
                <i class="fas fa-atom text-4xl text-black animate-spin-slow"></i>
            </div>
            <h1 class="text-4xl font-black mb-12 text-white">Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ø§Ù„Ø´Ø±Ø¨ÙŠÙ†ÙŠ Ù„Ù„Ø¹Ù„ÙˆÙ… ÙˆØ§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡ ğŸ§ª</h1>
            <button onclick="login()" class="btn-gold px-16 py-6 rounded-2xl font-black text-xl flex items-center gap-4 mx-auto">
                <i class="fab fa-google"></i> Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ù†ØµØ©
            </button>
        </div>
    </section>

    <header id="app-header" class="hidden sticky top-0 z-[1000] border-b border-white/5 bg-[#0f172a]/95 backdrop-blur-md px-6 py-4">
        <div class="container mx-auto flex justify-between items-center">
            <div class="relative">
                <div class="flex items-center gap-3 cursor-pointer group" onclick="toggleMenu()">
                    <img id="user-avatar" class="w-12 h-12 rounded-2xl border-2 border-[#c5a059]">
                    <span id="user-first-name" class="font-black text-white"></span>
                    <i class="fas fa-chevron-down text-[10px] text-[#c5a059]"></i>
                </div>
                <div id="drop-menu" class="p-2 animate__animated animate__fadeInUp">
                    <button onclick="openGradePicker()" class="w-full text-right p-4 hover:bg-white/5 rounded-xl text-sm font-black flex items-center gap-3"><i class="fas fa-sync text-[#c5a059]"></i> ØªØºÙŠÙŠØ± Ø§Ù„ØµÙ</button>
                    <button onclick="checkAdmin()" class="w-full text-right p-4 hover:bg-red-500/10 rounded-xl text-sm font-black text-red-400 flex items-center gap-3"><i class="fas fa-user-shield"></i> Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯Ø±Ø³</button>
                    <button onclick="logout()" class="w-full text-right p-4 hover:bg-white/5 rounded-xl text-sm font-black border-t border-white/5 mt-2 flex items-center gap-3"><i class="fas fa-power-off"></i> Ø®Ø±ÙˆØ¬</button>
                </div>
            </div>
            <h2 class="font-black text-xl text-[#c5a059] italic">Ù…Ù†ØµØ© Ø£\Ù…Ø­Ù…Ø¯ Ø§Ù„Ø´Ø±Ø¨ÙŠÙ†ÙŠ Ù„Ù„Ø¹Ù„ÙˆÙ… ÙˆØ§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡</h2>
        </div>
    </header>

    <div id="grade-picker" class="fixed inset-0 z-[8000] bg-[#080c14] hidden flex flex-col items-center justify-center p-6 text-center overflow-y-auto">
        <h3 class="text-3xl font-black mb-12 animate__animated animate__fadeInDown">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ.. Ø§Ø®ØªØ± ØµÙÙƒ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</h3>
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 w-full max-w-5xl animate__animated animate__zoomIn">
            <button onclick="selectGrade('1-mid', 'Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ')" class="p-10 bg-white/5 rounded-[40px] border border-white/10 font-black hover:border-white transition">Ø£ÙˆÙ„Ù‰ Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</button>
            <button onclick="selectGrade('2-mid', 'Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ')" class="p-10 bg-white/5 rounded-[40px] border border-white/10 font-black hover:border-white transition">ØªØ§Ù†ÙŠØ© Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</button>
            <button onclick="selectGrade('3-mid', 'Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ')" class="p-10 bg-white/5 rounded-[40px] border border-white/10 font-black hover:border-white transition">ØªØ§Ù„ØªØ© Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</button>
            <button onclick="selectGrade('1-sec', 'Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ')" class="p-10 bg-[#c5a059]/10 rounded-[40px] border border-[#c5a059]/30 font-black text-[#c5a059] hover:bg-[#c5a059]/20 transition">Ø£ÙˆÙ„Ù‰ Ø«Ø§Ù†ÙˆÙŠ</button>
            <button onclick="selectGrade('2-sec', 'Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ')" class="p-10 bg-[#c5a059]/10 rounded-[40px] border border-[#c5a059]/30 font-black text-[#c5a059] hover:bg-[#c5a059]/20 transition">ØªØ§Ù†ÙŠØ© Ø«Ø§Ù†ÙˆÙŠ</button>
            <button onclick="selectGrade('3-sec', 'Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ')" class="p-10 bg-[#c5a059]/10 rounded-[40px] border border-[#c5a059]/30 font-black text-[#c5a059] hover:bg-[#c5a059]/20 transition">ØªØ§Ù„ØªØ© Ø«Ø§Ù†ÙˆÙŠ</button>
        </div>
    </div>

    <div id="admin-modal">
        <div class="admin-box animate__animated animate__zoomIn">
            <div class="flex justify-between items-center mb-10 border-b border-white/10 pb-5">
                <h3 class="text-2xl font-black text-[#c5a059]">Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØµØ© âš™ï¸</h3>
                <i onclick="closeAdmin()" class="fas fa-times-circle text-4xl cursor-pointer text-slate-500 hover:text-white"></i>
            </div>
            
            <div class="grid grid-cols-1 gap-5 bg-[#080c14] p-8 rounded-[35px] border border-white/5 shadow-inner">
                <h4 class="font-black mb-2 text-[#c5a059]">Ø±ÙØ¹ Ù…Ø­Ø§Ø¶Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©:</h4>
                <input type="text" id="v-title" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¯Ø±Ø³" class="p-5 bg-white/5 rounded-2xl border border-white/10 outline-none focus:border-[#c5a059]">
                <input type="text" id="v-url" placeholder="Ø±Ø§Ø¨Ø· ÙŠÙˆØªÙŠÙˆØ¨ Ø£Ùˆ Ø¬ÙˆØ¬Ù„ Ø¯Ø±Ø§ÙŠÙ" class="p-5 bg-white/5 rounded-2xl border border-white/10 outline-none focus:border-[#c5a059]">
                <select id="v-grade" class="p-5 bg-[#111827] text-white rounded-2xl border border-white/10 outline-none font-bold">
                    <option value="1-mid">Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</option><option value="2-mid">Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</option><option value="3-mid">Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</option>
                    <option value="1-sec">Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option><option value="2-sec">Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option><option value="3-sec">Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                </select>
                <button onclick="publish()" id="pub-btn" class="btn-gold p-5 rounded-2xl font-black text-lg">Ù†Ø´Ø± Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø¢Ù† ğŸš€</button>
            </div>

            <div class="delete-section">
                <h4 class="font-black text-red-500 text-xl mb-8 flex items-center gap-3"><i class="fas fa-trash-alt"></i> Ù…Ø±ÙƒØ² Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</h4>
                <div id="admin-lessons-list" class="space-y-4 max-h-[400px] overflow-y-auto pr-2"></div>
            </div>
        </div>
    </div>

    <div id="video-player-modal" onclick="closePlayer()">
        <div class="video-container animate__animated animate__zoomIn" onclick="event.stopPropagation()">
            <iframe id="main-video-frame" src="" frameborder="0" 
                allow="autoplay; fullscreen; picture-in-picture;" 
                allowfullscreen webkitallowfullscreen mozallowfullscreen scrolling="yes"></iframe>
        </div>
        <button class="absolute top-8 right-8 text-white text-5xl hover:text-red-500 transition" onclick="closePlayer()">&times;</button>
    </div>

    <main id="app-content" class="hidden container mx-auto px-6 py-12">
        <div class="flex items-center gap-4 mb-12 border-r-8 border-[#c5a059] pr-6">
            <h3 id="grade-title" class="text-3xl font-black">Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</h3>
        </div>
        <div id="lesson-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-12"></div>
    </main>

    <script>
        // Ø§Ù„ØªÙˆØµÙŠÙ Ùˆ Firebase
        const config = { apiKey: "AIzaSyAyIsaApHUjEQWJgGhCom25pUj8Bm9LYyQ", authDomain: "sherbiny-academy.firebaseapp.com", projectId: "sherbiny-academy", storageBucket: "sherbiny-academy.firebasestorage.app", messagingSenderId: "349228281326", appId: "1:349228281326:web:ffbbf1eb5927b50d13f2ff" };
        firebase.initializeApp(config);
        const auth = firebase.auth(), db = firebase.firestore();
        let s_grade = localStorage.getItem('s_grade');

        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø© (Ø§Ù„Ø¯Ø®ÙˆÙ„)
        auth.onAuthStateChanged(user => {
            if (user) {
                document.getElementById('auth-screen').style.display = 'none';
                document.getElementById('app-header').classList.remove('hidden');
                document.getElementById('app-content').classList.remove('hidden');
                document.getElementById('user-avatar').src = user.photoURL;
                document.getElementById('user-first-name').innerText = user.displayName.split(' ')[0];
                if(!s_grade) openGradePicker(); else selectGrade(s_grade, "");
            }
        });

        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆØ§Ù„Ù…Ù†ÙŠÙˆ
        async function login() { const p = new firebase.auth.GoogleAuthProvider(); await auth.signInWithPopup(p); }
        function logout() { auth.signOut(); localStorage.removeItem('s_grade'); location.reload(); }
        function toggleMenu() { const m = document.getElementById('drop-menu'); m.style.display = (m.style.display === 'block') ? 'none' : 'block'; }
        function openGradePicker() { document.getElementById('grade-picker').classList.remove('hidden'); if(document.getElementById('drop-menu').style.display === 'block') toggleMenu(); }
        
        function selectGrade(id, name) {
            s_grade = id;
            localStorage.setItem('s_grade', id);
            document.getElementById('grade-picker').classList.add('hidden');
            const map = {'1-mid':'Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ','2-mid':'Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ','3-mid':'Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ','1-sec':'Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ','2-sec':'Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ','3-sec':'Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ'};
            document.getElementById('grade-title').innerText = "Ù…Ø­Ø§Ø¶Ø±Ø§Øª " + (name || map[id]);
            loadLessons(id);
        }

        function formatUrl(url) {
            if (url.includes('youtube.com/watch?v=')) return url.replace('watch?v=', 'embed/') + "?rel=0&showinfo=0&controls=1";
            if (url.includes('youtu.be/')) return url.replace('youtu.be/', 'youtube.com/embed/') + "?rel=0&showinfo=0&controls=1";
            if (url.includes('drive.google.com')) return url.replace(/\/view.*|\/edit.*|\/preview.*/, '/preview');
            return url;
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯Ø±ÙˆØ³
        let unsubscribe = null; 
        function loadLessons(gradeId) {
            const grid = document.getElementById('lesson-grid');
            if (unsubscribe) unsubscribe(); 
            unsubscribe = db.collection("lessons").where("grade", "==", gradeId).onSnapshot(snap => {
                if(snap.empty) { grid.innerHTML = '<div class="col-span-full text-center py-32 opacity-20 text-2xl font-black">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¯Ø±ÙˆØ³ Ø­Ø§Ù„ÙŠØ§Ù‹</div>'; return; }
                let h = "";
                snap.forEach(doc => {
                    const item = doc.data();
                    let preview = "";
                    if(item.url.includes('drive.google.com')) {
                        preview = `<iframe src="${formatUrl(item.url)}" class="w-full h-full pointer-events-none border-none opacity-100" style="object-fit:cover" scrolling="no"></iframe>
                                  <div class="absolute inset-0 bg-transparent"></div>`;
                    }
                    h += `<div class="lesson-card p-8 animate__animated animate__fadeInUp">
                            <div class="h-48 bg-slate-900 rounded-[30px] mb-8 flex items-center justify-center cursor-pointer group overflow-hidden relative" onclick="playVideo('${item.url}')">
                                ${preview}
                            </div>
                            <h4 class="font-black text-lg mb-8 h-12 overflow-hidden text-slate-200 text-center">${item.title}</h4>
                            <button onclick="playVideo('${item.url}')" class="btn-gold w-full py-5 rounded-2xl font-black">Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø­ØµØ© Ø§Ù„Ø¢Ù†</button>
                          </div>`;
                });
                grid.innerHTML = h;
            });
        }

        // Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø¥Ø¶Ø§ÙØ© ÙˆØ­Ø°Ù
        async function publish() {
            const t = document.getElementById('v-title').value, u = document.getElementById('v-url').value, g = document.getElementById('v-grade').value, btn = document.getElementById('pub-btn');
            if(!t || !u) return alert("Ø§Ù…Ù„Ø£ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!");
            btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹..."; btn.disabled = true;
            await db.collection("lessons").add({ title: t, url: u, grade: g, createdAt: firebase.firestore.FieldValue.serverTimestamp() });
            alert("ØªÙ… Ø§Ù„Ø±ÙØ¹ âœ…");
            document.getElementById('v-title').value = ""; document.getElementById('v-url').value = "";
            btn.innerText = "Ù†Ø´Ø± Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø¢Ù† ğŸš€"; btn.disabled = false;
            loadAdminLessons();
        }

        function loadAdminLessons() {
            const list = document.getElementById('admin-lessons-list');
            db.collection("lessons").where("grade", "==", s_grade).get().then(snap => {
                let h = "";
                snap.forEach(doc => {
                    h += `<div class="delete-card flex justify-between items-center animate__animated animate__fadeInRight">
                            <div class="flex flex-col"><span class="font-black text-sm text-white">${doc.data().title}</span></div>
                            <button onclick="deleteDoc('${doc.id}')" class="bg-red-600/10 text-red-500 border border-red-500/30 px-6 py-3 rounded-xl font-black hover:bg-red-600 hover:text-white transition">Ø­Ø°Ù</button>
                          </div>`;
                });
                list.innerHTML = h;
            });
        }

        async function deleteDoc(id) { if(confirm("Ø­Ø°Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆØŸ")) { await db.collection("lessons").doc(id).delete(); alert("ØªÙ… Ø§Ù„Ø­Ø°Ù âœ…"); loadAdminLessons(); } }

        function checkAdmin() { 
            const pass = prompt("ÙƒÙˆØ¯ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:"); 
            if(btoa(pass) === "U2hlcmJpbnlAMjAyNg==") { document.getElementById('admin-modal').style.display = 'flex'; loadAdminLessons(); } 
            else { alert("Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­!"); }
        }

        function closeAdmin() { document.getElementById('admin-modal').style.display = 'none'; }
        
        function playVideo(url) { 
            const frame = document.getElementById('main-video-frame');
            frame.src = formatUrl(url); 
            document.getElementById('video-player-modal').style.display = 'flex'; 
        }

        function closePlayer() { 
            document.getElementById('main-video-frame').src = ""; 
            document.getElementById('video-player-modal').style.display = 'none'; 
        }
    </script>
</body>
</html>

