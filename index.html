<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ø§Ù„Ø´Ø±Ø¨ÙŠÙ†ÙŠ Ù„Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡ | Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ø±Ø³Ù…ÙŠØ©</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap');
        :root { --gold: #c5a059; --dark: #080c14; --panel: #111827; }
        body { font-family: 'Cairo', sans-serif; background: radial-gradient(circle at top, #1e293b 0%, var(--dark) 100%); color: white; min-height: 100vh; overflow-x: hidden; }
        
        /* Ù…Ø´ØºÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ */
        #video-player-modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.98); z-index: 20000; align-items: center; justify-content: center; }
        .video-container { width: 95%; max-width: 1000px; aspect-ratio: 16/9; background: black; border-radius: 30px; border: 2px solid var(--gold); overflow: hidden; box-shadow: 0 0 50px rgba(197, 160, 89, 0.2); }

        /* Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯Ø±Ø³ */
        #admin-modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 10000; padding: 20px; overflow-y: auto; }
        .admin-box { background: var(--panel); border: 2px solid var(--gold); width: 100%; max-width: 750px; border-radius: 40px; padding: 35px; margin: auto; }

        /* ÙƒØ±ÙˆØª Ø§Ù„Ø¯Ø±ÙˆØ³ */
        .lesson-card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05); border-radius: 35px; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .lesson-card:hover { border-color: var(--gold); transform: translateY(-10px); background: rgba(197, 160, 89, 0.05); }
        
        /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ÙŠÙˆ Ø§Ù„Ù…Ø¹ØªÙ…Ø© */
        #drop-menu { background: var(--panel) !important; border: 2px solid var(--gold); display: none; position: absolute; top: 70px; right: 0; width: 240px; z-index: 9999; border-radius: 25px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .btn-gold { background: linear-gradient(135deg, #c5a059 0%, #edd3a1 100%); color: #080c14; font-weight: 900; transition: 0.3s; }
        .btn-gold:active { transform: scale(0.96); }

        .loader { width: 45px; height: 45px; border: 5px solid var(--gold); border-top-color: transparent; border-radius: 50%; animation: spin 1s linear infinite; margin: 40px auto; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-thumb { background: var(--gold); border-radius: 10px; }
    </style>
</head>
<body>

    <section id="auth-screen" class="fixed inset-0 z-[9999] flex flex-col items-center justify-center bg-[#080c14]">
        <div class="text-center animate__animated animate__zoomIn">
            <div class="w-24 h-24 bg-[#c5a059] rounded-[35px] mx-auto mb-10 flex items-center justify-center shadow-2xl animate__animated animate__pulse animate__infinite">
                <i class="fas fa-atom text-4xl text-black"></i>
            </div>
            <h1 class="text-4xl font-black mb-12 text-white">Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ø§Ù„Ø´Ø±Ø¨ÙŠÙ†ÙŠ</h1>
            <button onclick="login()" class="btn-gold px-14 py-5 rounded-2xl flex items-center gap-4 text-xl shadow-xl">
                <i class="fab fa-google"></i> Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ù†ØµØ©
            </button>
        </div>
    </section>

    <header id="app-header" class="hidden sticky top-0 z-[1000] border-b border-white/5 bg-[#0f172a]/95 backdrop-blur-md px-5 py-4">
        <div class="container mx-auto flex justify-between items-center">
            <div class="relative">
                <div class="flex items-center gap-3 cursor-pointer group" onclick="toggleMenu()">
                    <img id="user-avatar" class="w-12 h-12 rounded-2xl border-2 border-[#c5a059] transition group-hover:scale-105">
                    <span id="user-first-name" class="font-black text-sm text-white"></span>
                    <i class="fas fa-chevron-down text-[10px] text-[#c5a059]"></i>
                </div>
                <div id="drop-menu" class="p-2 animate__animated animate__fadeInUp animate__faster">
                    <button onclick="openGradePicker()" class="w-full text-right p-4 hover:bg-white/5 rounded-2xl text-xs font-black flex items-center gap-3"><i class="fas fa-sync text-[#c5a059]"></i> ØªØºÙŠÙŠØ± Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</button>
                    <button onclick="checkAdmin()" class="w-full text-right p-4 hover:bg-red-500/10 rounded-2xl text-xs font-black text-red-400 flex items-center gap-3"><i class="fas fa-user-shield"></i> Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯Ø±Ø³</button>
                    <button onclick="logout()" class="w-full text-right p-4 hover:bg-white/5 rounded-2xl text-xs font-black text-slate-500 border-t border-white/5 mt-2 flex items-center gap-3"><i class="fas fa-power-off"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
                </div>
            </div>
            <h2 class="font-black text-xl italic tracking-tighter text-[#c5a059]">SHERBINY ACADEMY</h2>
        </div>
    </header>

    <div id="grade-picker" class="fixed inset-0 z-[8000] bg-[#080c14] hidden flex flex-col items-center justify-center p-6 text-center overflow-y-auto">
        <h3 class="text-3xl font-black mb-12 animate__animated animate__fadeInDown">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© ğŸ§ª</h3>
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 w-full max-w-5xl px-4 animate__animated animate__zoomIn">
            <button onclick="selectGrade('1-mid', 'Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ')" class="p-10 bg-white/5 rounded-[40px] border border-white/5 hover:border-blue-400 transition-all font-black text-slate-300">Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</button>
            <button onclick="selectGrade('2-mid', 'Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ')" class="p-10 bg-white/5 rounded-[40px] border border-white/5 hover:border-blue-400 transition-all font-black text-slate-300">Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</button>
            <button onclick="selectGrade('3-mid', 'Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ')" class="p-10 bg-white/5 rounded-[40px] border border-white/5 hover:border-blue-400 transition-all font-black text-slate-300">Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</button>
            <button onclick="selectGrade('1-sec', 'Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ')" class="p-10 bg-[#c5a059]/5 rounded-[40px] border border-[#c5a059]/20 hover:border-[#c5a059] transition-all font-black text-[#c5a059]">Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</button>
            <button onclick="selectGrade('2-sec', 'Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ')" class="p-10 bg-[#c5a059]/5 rounded-[40px] border border-[#c5a059]/20 hover:border-[#c5a059] transition-all font-black text-[#c5a059]">Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</button>
            <button onclick="selectGrade('3-sec', 'Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ')" class="p-10 bg-[#c5a059]/10 rounded-[40px] border border-[#c5a059]/30 hover:border-[#c5a059] transition-all font-black text-[#c5a059]">Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</button>
        </div>
    </div>

    <div id="admin-modal">
        <div class="admin-box my-10 animate__animated animate__zoomIn">
            <div class="flex justify-between items-center mb-10 pb-4 border-b border-white/10">
                <h3 class="text-2xl font-black text-[#c5a059]">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ âš™ï¸</h3>
                <i onclick="closeAdmin()" class="fas fa-times-circle text-3xl cursor-pointer text-slate-500 hover:text-white transition"></i>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mb-10 pb-10 border-b border-white/10">
                <input type="text" id="v-title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¯Ø±Ø³" class="p-5 bg-white/5 rounded-2xl outline-none border border-white/10 focus:border-[#c5a059]">
                <input type="text" id="v-url" placeholder="Ø±Ø§Ø¨Ø· ÙŠÙˆØªÙŠÙˆØ¨ Ø£Ùˆ Ø¬ÙˆØ¬Ù„ Ø¯Ø±Ø§ÙŠÙ" class="p-5 bg-white/5 rounded-2xl outline-none border border-white/10 focus:border-[#c5a059]">
                <select id="v-grade" class="p-5 bg-[#111827] rounded-2xl border border-white/10 outline-none font-bold text-white">
                    <option value="1-mid">Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</option><option value="2-mid">Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</option><option value="3-mid">Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</option>
                    <option value="1-sec">Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option><option value="2-sec">Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option><option value="3-sec">Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                </select>
                <button onclick="publish()" class="btn-gold rounded-2xl font-black py-5 shadow-lg">Ù†Ø´Ø± Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø¢Ù† ğŸš€</button>
            </div>

            <h4 class="font-black mb-6 text-sm text-slate-500">Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Ø§Ø¶ØºØ· Ù„Ù„Ø­Ø°Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù…Ù† Ø¬ÙˆØ¬Ù„):</h4>
            <div id="admin-lessons-list" class="space-y-3 max-h-80 overflow-y-auto pr-3"></div>
        </div>
    </div>

    <div id="video-player-modal" onclick="closePlayer()">
        <div class="video-container animate__animated animate__zoomIn" onclick="event.stopPropagation()">
            <iframe id="main-video-frame" class="w-full h-full" src="" frameborder="0" allow="autoplay; fullscreen" allowfullscreen></iframe>
        </div>
        <button class="absolute top-8 right-8 text-white text-5xl hover:text-red-500 transition"><i class="fas fa-times"></i></button>
    </div>

    <main id="app-content" class="hidden container mx-auto px-6 py-12">
        <div class="mb-14 flex justify-between items-center border-r-4 border-[#c5a059] pr-5">
            <h3 id="grade-badge-title" class="text-3xl font-black">Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</h3>
        </div>
        <div id="lesson-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-12"></div>
    </main>

    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyAyIsaApHUjEQWJgGhCom25pUj8Bm9LYyQ",
            authDomain: "sherbiny-academy.firebaseapp.com",
            projectId: "sherbiny-academy",
            storageBucket: "sherbiny-academy.firebasestorage.app",
            messagingSenderId: "349228281326",
            appId: "1:349228281326:web:ffbbf1eb5927b50d13f2ff"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let s_grade = localStorage.getItem('s_grade');

        auth.onAuthStateChanged(user => {
            if (user) {
                document.getElementById('auth-screen').style.display = 'none';
                document.getElementById('app-header').classList.remove('hidden');
                document.getElementById('app-content').classList.remove('hidden');
                document.getElementById('user-avatar').src = user.photoURL;
                document.getElementById('user-first-name').innerText = user.displayName.split(' ')[0];
                if(!s_grade) openGradePicker(); else selectGrade(s_grade, getGradeName(s_grade));
            } else {
                document.getElementById('auth-screen').style.display = 'flex';
            }
        });

        async function login() { const p = new firebase.auth.GoogleAuthProvider(); try { await auth.signInWithPopup(p); } catch(e) { auth.signInWithRedirect(p); } }
        function logout() { auth.signOut(); localStorage.removeItem('s_grade'); location.reload(); }
        function toggleMenu() { const m = document.getElementById('drop-menu'); m.style.display = (m.style.display === 'block') ? 'none' : 'block'; }
        function openGradePicker() { document.getElementById('grade-picker').classList.remove('hidden'); }
        
        function getGradeName(id) {
            const m = {'1-mid':'Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ','2-mid':'Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ','3-mid':'Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ','1-sec':'Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ','2-sec':'Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ','3-sec':'Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ'};
            return m[id] || "Ø¹Ø§Ù…";
        }

        function selectGrade(id, name) {
            s_grade = id;
            localStorage.setItem('s_grade', id);
            document.getElementById('grade-picker').classList.add('hidden');
            document.getElementById('grade-badge-title').innerText = "Ù…Ø­Ø§Ø¶Ø±Ø§Øª " + (name || getGradeName(id));
            document.getElementById('drop-menu').style.display = 'none';
            loadLessons(id);
        }

        function formatVideoUrl(url) {
            if (url.includes('youtube.com/watch?v=')) return url.replace('watch?v=', 'embed/');
            if (url.includes('youtu.be/')) return url.replace('youtu.be/', 'youtube.com/embed/');
            if (url.includes('drive.google.com') && url.includes('/view')) return url.replace('/view', '/preview');
            return url;
        }

        function playVideo(url) {
            document.getElementById('main-video-frame').src = formatVideoUrl(url);
            document.getElementById('video-player-modal').style.display = 'flex';
        }

        function closePlayer() {
            document.getElementById('main-video-frame').src = "";
            document.getElementById('video-player-modal').style.display = 'none';
        }

        function checkAdmin() {
            if(prompt("ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:") === "123") {
                document.getElementById('admin-modal').style.display = 'flex';
                loadAdminLessons();
            } else alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙƒÙˆØ¯!");
        }

        function closeAdmin() { document.getElementById('admin-modal').style.display = 'none'; }

        async function publish() {
            const t = document.getElementById('v-title').value, u = document.getElementById('v-url').value, g = document.getElementById('v-grade').value;
            if(!t || !u) return alert("ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹!");
            await db.collection("lessons").add({ title: t, url: u, grade: g, createdAt: firebase.firestore.FieldValue.serverTimestamp() });
            alert("ØªÙ… Ø±ÙØ¹ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ø¨Ù†Ø¬Ø§Ø­ Ù„Ù…ÙˆÙ‚Ø¹ Ø¬ÙˆØ¬Ù„ âœ…");
            document.getElementById('v-title').value = ""; document.getElementById('v-url').value = "";
            loadAdminLessons();
        }

        function loadLessons(gradeId) {
            const grid = document.getElementById('lesson-grid');
            grid.innerHTML = '<div class="col-span-full"><div class="loader"></div></div>';
            db.collection("lessons").where("grade", "==", gradeId).orderBy("createdAt", "desc").onSnapshot(snap => {
                let h = "";
                snap.forEach(doc => {
                    const item = doc.data();
                    h += `
                        <div class="lesson-card p-8 animate__animated animate__fadeInUp">
                            <div class="h-48 bg-slate-900 rounded-[30px] mb-8 flex items-center justify-center relative group cursor-pointer" onclick="playVideo('${item.url}')">
                                <i class="fas fa-play text-5xl text-[#c5a059] opacity-40 group-hover:scale-110 group-hover:opacity-100 transition"></i>
                            </div>
                            <h4 class="font-bold text-base mb-8 h-12 overflow-hidden text-slate-200 leading-relaxed">${item.title}</h4>
                            <button onclick="playVideo('${item.url}')" class="btn-gold w-full py-5 rounded-2xl text-[11px] font-black shadow-lg">Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø­ØµØ© Ø§Ù„Ø¢Ù†</button>
                        </div>`;
                });
                grid.innerHTML = h || '<p class="col-span-full text-center py-20 opacity-20 text-xl font-black">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¯Ø±ÙˆØ³ Ø­Ø§Ù„ÙŠØ§Ù‹</p>';
            });
        }

        function loadAdminLessons() {
            const list = document.getElementById('admin-lessons-list');
            list.innerHTML = "Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...";
            db.collection("lessons").where("grade", "==", s_grade).get().then(snap => {
                let h = "";
                snap.forEach(doc => {
                    h += `<div class="flex justify-between items-center bg-white/5 p-5 rounded-2xl border border-white/5 animate__animated animate__fadeInRight">
                            <span class="text-xs font-bold truncate ml-4">${doc.data().title}</span>
                            <button onclick="deleteDoc('${doc.id}')" class="text-red-500 hover:bg-red-500/10 px-5 py-2 rounded-xl text-xs font-black border border-red-500/20 transition">Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ</button>
                          </div>`;
                });
                list.innerHTML = h || "Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙØ§Ø±ØºØ© Ù„Ù‡Ø°Ø§ Ø§Ù„ØµÙ";
            });
        }

        async function deleteDoc(id) {
            if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¯Ø±Ø³ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ")) {
                try {
                    await db.collection("lessons").doc(id).delete();
                    alert("ØªÙ… Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø¬Ø§Ø­ Ù…Ù† Ø¬ÙˆØ¬Ù„ âœ…");
                    loadAdminLessons();
                } catch(e) { alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù!"); }
            }
        }
    </script>
</body>
</html>
