<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ø§Ù„Ø´Ø±Ø¨ÙŠÙ†ÙŠ Ù„Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡ | 2026</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap');
        :root { --gold: #c5a059; --dark: #080c14; --menu-bg: #111827; }
        body { font-family: 'Cairo', sans-serif; background: radial-gradient(circle at top, #1e293b 0%, var(--dark) 100%); color: white; min-height: 100vh; overflow-x: hidden; }
        
        /* Ù…Ø´ØºÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø³ÙŠÙ†Ù…Ø§Ø¦ÙŠ */
        #video-player-modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.98); z-index: 20000; align-items: center; justify-content: center; }
        .video-container { width: 95%; max-width: 1000px; aspect-ratio: 16/9; background: black; border-radius: 25px; overflow: hidden; border: 2px solid var(--gold); box-shadow: 0 0 50px rgba(197, 160, 89, 0.2); }

        /* Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯Ø±Ø³ */
        #admin-modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 10000; padding: 20px; overflow-y: auto; }
        .admin-box { background: var(--menu-bg); border: 2px solid var(--gold); width: 100%; max-width: 700px; border-radius: 30px; padding: 30px; margin: auto; box-shadow: 0 20px 60px rgba(0,0,0,1); }

        /* ÙƒØ±ÙˆØª Ø§Ù„Ø¯Ø±ÙˆØ³ */
        .lesson-card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05); border-radius: 30px; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); position: relative; overflow: hidden; }
        .lesson-card:hover { border-color: var(--gold); transform: translateY(-10px); background: rgba(197, 160, 89, 0.05); }
        
        /* Ø§Ù„Ù…Ù†ÙŠÙˆ Ø§Ù„Ù…Ø¹ØªÙ… */
        #drop-menu { background: var(--menu-bg) !important; border: 2px solid var(--gold); display: none; position: absolute; top: 65px; right: 0; width: 230px; z-index: 9999; border-radius: 20px; box-shadow: 0 15px 40px rgba(0,0,0,0.8); }
        .btn-gold { background: linear-gradient(135deg, #c5a059 0%, #edd3a1 100%); color: #080c14; font-weight: 900; transition: 0.3s; }
        .btn-gold:active { transform: scale(0.95); }

        .loader { width: 40px; height: 40px; border: 4px solid var(--gold); border-top-color: transparent; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: var(--gold); border-radius: 10px; }
    </style>
</head>
<body>

    <section id="auth-screen" class="fixed inset-0 z-[9999] flex items-center justify-center bg-[#080c14]">
        <div class="text-center animate__animated animate__zoomIn">
            <div class="w-24 h-24 bg-[#c5a059] rounded-[35px] mx-auto mb-8 flex items-center justify-center shadow-2xl animate__animated animate__pulse animate__infinite">
                <i class="fas fa-atom text-4xl text-black"></i>
            </div>
            <h1 class="text-3xl font-black mb-10">Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ø§Ù„Ø´Ø±Ø¨ÙŠÙ†ÙŠ</h1>
            <button onclick="login()" class="btn-gold px-12 py-5 rounded-2xl flex items-center gap-3 text-lg">
                <i class="fab fa-google"></i> Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ù†ØµØ©
            </button>
        </div>
    </section>

    <header id="app-header" class="hidden sticky top-0 z-[1000] border-b border-white/5 bg-[#0f172a]/95 backdrop-blur-md">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="relative">
                <div class="flex items-center gap-3 cursor-pointer group" onclick="toggleMenu()">
                    <img id="user-avatar" class="w-11 h-11 rounded-2xl border-2 border-[#c5a059] transition group-hover:rotate-6">
                    <span id="user-first-name" class="hidden md:block text-sm font-black text-white"></span>
                    <i class="fas fa-chevron-down text-[10px] text-[#c5a059]"></i>
                </div>
                <div id="drop-menu" class="p-2 animate__animated animate__fadeInUp animate__faster">
                    <button onclick="openGradePicker()" class="w-full text-right p-3 hover:bg-white/5 rounded-xl text-xs font-black flex items-center gap-2"><i class="fas fa-sync text-[#c5a059]"></i> ØªØºÙŠÙŠØ± Ø§Ù„ØµÙ</button>
                    <button onclick="checkAdmin()" class="w-full text-right p-3 hover:bg-red-500/10 rounded-xl text-xs font-black text-red-400 flex items-center gap-2"><i class="fas fa-user-shield"></i> Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯Ø±Ø³</button>
                    <button onclick="logout()" class="w-full text-right p-3 hover:bg-white/5 rounded-xl text-xs font-black text-slate-500 border-t border-white/5 mt-2 flex items-center gap-2"><i class="fas fa-power-off"></i> Ø®Ø±ÙˆØ¬</button>
                </div>
            </div>
            <h2 class="font-black text-xl italic tracking-tighter">AL-SHERBINY <span class="text-[#c5a059]">ACADEMY</span></h2>
        </div>
    </header>

    <div id="video-player-modal" onclick="closePlayer()">
        <div class="video-container animate__animated animate__zoomIn" onclick="event.stopPropagation()">
            <iframe id="main-video-frame" class="w-full h-full" src="" frameborder="0" allow="autoplay; fullscreen" allowfullscreen></iframe>
        </div>
        <button class="absolute top-8 right-8 text-white text-5xl hover:text-red-500 transition"><i class="fas fa-times"></i></button>
    </div>

    <div id="admin-modal">
        <div class="admin-box my-10 animate__animated animate__zoomIn">
            <div class="flex justify-between items-center mb-8">
                <h3 class="text-2xl font-black text-[#c5a059]">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø³ØªØ§Ø° âš™ï¸</h3>
                <i onclick="closeAdmin()" class="fas fa-times-circle text-3xl cursor-pointer text-slate-500 hover:text-white"></i>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-10 pb-10 border-b border-white/10">
                <input type="text" id="v-title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©" class="p-4 bg-white/5 rounded-2xl outline-none border border-white/10 focus:border-[#c5a059]">
                <input type="text" id="v-url" placeholder="Ø±Ø§Ø¨Ø· ÙŠÙˆØªÙŠÙˆØ¨ Ø£Ùˆ Ø¯Ø±Ø§ÙŠÙ" class="p-4 bg-white/5 rounded-2xl outline-none border border-white/10 focus:border-[#c5a059]">
                <select id="v-grade" class="p-4 bg-[#111827] rounded-2xl border border-white/10 outline-none font-bold">
                    <option value="1-mid">Ø£ÙˆÙ„Ù‰ Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</option><option value="2-mid">ØªØ§Ù†ÙŠØ© Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</option><option value="3-mid">ØªØ§Ù„ØªØ© Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</option>
                    <option value="1-sec">Ø£ÙˆÙ„Ù‰ Ø«Ø§Ù†ÙˆÙŠ</option><option value="2-sec">ØªØ§Ù†ÙŠØ© Ø«Ø§Ù†ÙˆÙŠ</option><option value="3-sec">ØªØ§Ù„ØªØ© Ø«Ø§Ù†ÙˆÙŠ</option>
                </select>
                <button id="pub-btn" onclick="publish()" class="btn-gold rounded-2xl font-black py-4 shadow-lg shadow-gold/20">Ù†Ø´Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ğŸš€</button>
            </div>

            <h4 class="font-black mb-4 text-sm text-slate-500">Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Ø§Ø¶ØºØ· Ù„Ù„Ø­Ø°Ù):</h4>
            <div id="admin-lessons-list" class="space-y-3 max-h-80 overflow-y-auto pr-2">
                </div>
        </div>
    </div>

    <div id="grade-picker" class="fixed inset-0 z-[8000] bg-[#080c14] hidden flex flex-col items-center justify-center p-6 text-center">
        <h3 class="text-3xl font-black mb-12 animate__animated animate__fadeInDown">Ø§Ø®ØªØ± ØµÙÙƒ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ ğŸ§ª</h3>
        <div class="grid grid-cols-2 md:grid-cols-3 gap-5 w-full max-w-3xl">
            <button onclick="selectGrade('1-mid', 'Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ')" class="p-8 bg-white/5 rounded-[30px] border border-white/5 hover:border-[#c5a059] transition-all group animate__animated animate__fadeInUp">
                <i class="fas fa-flask text-3xl mb-4 text-blue-400 group-hover:scale-125 transition"></i>
                <p class="font-black text-sm text-slate-300">Ø£ÙˆÙ„Ù‰ Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</p>
            </button>
            <button onclick="selectGrade('3-sec', 'Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ')" class="p-8 bg-[#c5a059]/10 rounded-[30px] border border-[#c5a059]/30 hover:border-[#c5a059] transition-all group animate__animated animate__fadeInUp">
                <i class="fas fa-atom text-3xl mb-4 text-[#c5a059] group-hover:scale-125 transition"></i>
                <p class="font-black text-sm text-[#c5a059]">ØªØ§Ù„ØªØ© Ø«Ø§Ù†ÙˆÙŠ</p>
            </button>
            </div>
    </div>

    <main id="app-content" class="hidden container mx-auto px-6 py-12">
        <div class="mb-12 flex justify-between items-center">
            <h3 class="text-2xl font-black pr-4 border-r-4 border-[#c5a059] animate__animated animate__fadeInRight">Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„Ù…ØªÙˆÙØ±Ø©</h3>
            <span id="grade-badge" class="bg-white/5 text-[#c5a059] px-4 py-2 rounded-xl text-[10px] font-black border border-[#c5a059]/20"></span>
        </div>
        <div id="lesson-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10"></div>
    </main>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAyIsaApHUjEQWJgGhCom25pUj8Bm9LYyQ",
            authDomain: "sherbiny-academy.firebaseapp.com",
            projectId: "sherbiny-academy",
            storageBucket: "sherbiny-academy.firebasestorage.app",
            messagingSenderId: "349228281326",
            appId: "1:349228281326:web:ffbbf1eb5927b50d13f2ff"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let currentGrade = localStorage.getItem('s_grade');

        auth.onAuthStateChanged(user => {
            if (user) {
                document.getElementById('auth-screen').style.display = 'none';
                document.getElementById('app-header').classList.remove('hidden');
                document.getElementById('app-content').classList.remove('hidden');
                document.getElementById('user-avatar').src = user.photoURL;
                document.getElementById('user-first-name').innerText = user.displayName.split(' ')[0];
                if(!currentGrade) openGradePicker(); else selectGrade(currentGrade, getGradeName(currentGrade));
            } else {
                document.getElementById('auth-screen').style.display = 'flex';
            }
        });

        async function login() { const p = new firebase.auth.GoogleAuthProvider(); try { await auth.signInWithPopup(p); } catch(e) { auth.signInWithRedirect(p); } }
        function logout() { auth.signOut(); localStorage.removeItem('s_grade'); location.reload(); }
        function toggleMenu() { const m = document.getElementById('drop-menu'); m.style.display = (m.style.display === 'block') ? 'none' : 'block'; }
        function openGradePicker() { document.getElementById('grade-picker').classList.remove('hidden'); }
        
        function selectGrade(id, name) {
            currentGrade = id;
            localStorage.setItem('s_grade', id);
            document.getElementById('grade-picker').classList.add('hidden');
            document.getElementById('grade-badge').innerText = name || getGradeName(id);
            document.getElementById('drop-menu').style.display = 'none';
            loadLessons(id);
        }

        function getGradeName(id) {
            const m = {'1-mid':'Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ','3-sec':'Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ'}; // Ø£ÙƒÙ…Ù„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
            return m[id] || "Ø¹Ø§Ù…";
        }

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø±ÙˆØ§Ø¨Ø· ÙŠÙˆØªÙŠÙˆØ¨ ÙˆØ¯Ø±Ø§ÙŠÙ Ù„Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ
        function formatVideoUrl(url) {
            if (url.includes('youtube.com/watch?v=')) return url.replace('watch?v=', 'embed/');
            if (url.includes('youtu.be/')) return url.replace('youtu.be/', 'youtube.com/embed/');
            if (url.includes('drive.google.com') && url.includes('/view')) return url.replace('/view', '/preview');
            return url;
        }

        function playVideo(url) {
            document.getElementById('main-video-frame').src = formatVideoUrl(url);
            document.getElementById('video-player-modal').style.display = 'flex';
        }

        function closePlayer() {
            document.getElementById('main-video-frame').src = "";
            document.getElementById('video-player-modal').style.display = 'none';
        }

        function checkAdmin() {
            if(prompt("ÙƒÙˆØ¯ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ø±ÙŠ:") === "123") {
                document.getElementById('admin-modal').style.display = 'flex';
                loadAdminLessons();
            } else alert("ÙƒÙˆØ¯ Ø®Ø§Ø·Ø¦!");
        }

        function closeAdmin() { document.getElementById('admin-modal').style.display = 'none'; }

        async function publish() {
            const t = document.getElementById('v-title').value, u = document.getElementById('v-url').value, g = document.getElementById('v-grade').value;
            if(!t || !u) return alert("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ ÙƒØ§ÙØ© Ø§Ù„Ø®Ø§Ù†Ø§Øª!");
            const btn = document.getElementById('pub-btn');
            btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù†Ø´Ø±..."; btn.disabled = true;
            await db.collection("lessons").add({ title: t, url: u, grade: g, createdAt: firebase.firestore.FieldValue.serverTimestamp() });
            alert("ØªÙ… Ø¨Ù†Ø¬Ø§Ø­! âœ…");
            btn.innerText = "Ù†Ø´Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ğŸš€"; btn.disabled = false;
            loadAdminLessons(); loadLessons(currentGrade);
        }

        function loadLessons(gradeId) {
            const grid = document.getElementById('lesson-grid');
            grid.innerHTML = '<div class="col-span-full text-center py-20"><span class="loader mx-auto"></span></div>';
            db.collection("lessons").where("grade", "==", gradeId).onSnapshot(snap => {
                let h = "";
                snap.forEach(doc => {
                    const item = doc.data();
                    const isPdf = item.url.includes('.pdf') || item.url.includes('drive.google.com');
                    h += `
                        <div class="lesson-card p-6 animate__animated animate__fadeInUp">
                            <div class="h-44 bg-slate-900 rounded-[25px] mb-6 flex items-center justify-center relative group cursor-pointer" onclick="playVideo('${item.url}')">
                                <i class="fas ${isPdf ? 'fa-file-pdf text-red-500' : 'fa-play text-[#c5a059]'} text-5xl opacity-40 group-hover:opacity-100 group-hover:scale-125 transition"></i>
                                <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition"></div>
                            </div>
                            <h4 class="font-bold text-sm mb-6 h-12 overflow-hidden text-slate-200 leading-relaxed">${item.title}</h4>
                            <button onclick="playVideo('${item.url}')" class="btn-gold w-full py-4 rounded-2xl text-[10px] font-black shadow-lg">Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø­ØµØ© Ø§Ù„Ø¢Ù†</button>
                        </div>`;
                });
                grid.innerHTML = h || '<p class="col-span-full text-center py-20 opacity-20 text-xl font-black italic">No Lessons Found</p>';
            });
        }

        function loadAdminLessons() {
            const list = document.getElementById('admin-lessons-list');
            list.innerHTML = '<span class="loader scale-50"></span>';
            db.collection("lessons").where("grade", "==", currentGrade).get().then(snap => {
                let h = "";
                snap.forEach(doc => {
                    h += `<div class="flex justify-between items-center bg-white/5 p-4 rounded-2xl border border-white/5 animate__animated animate__fadeInRight">
                            <span class="text-[10px] font-bold truncate ml-4">${doc.data().title}</span>
                            <button onclick="deleteDoc('${doc.id}')" class="text-red-500 hover:bg-red-500/10 px-4 py-2 rounded-xl text-[10px] font-black transition">Ø­Ø°Ù</button>
                          </div>`;
                });
                list.innerHTML = h || "Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙØ§Ø±ØºØ©";
            });
        }

        async function deleteDoc(id) {
            if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) {
                await db.collection("lessons").doc(id).delete();
                loadAdminLessons(); loadLessons(currentGrade);
            }
        }
    </script>
</body>
</html>
